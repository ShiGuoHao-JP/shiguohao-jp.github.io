# 💼 ポートフォリオ

## 基本情報

- **氏名**：石　国豪
- **職種**：ゲームクライアントエンジニア
- **経験年数**：5年（NetEase Games）

---

## 参加プロジェクト一覧

### [Dunk City Dynast](https://www.dunkcitymobile.com/#/)

![Dunk City Dynast Icon](./img/DCD_Icon.png)

> NetEase Games (中国 网易) &ensp; 雷火部 &ensp; 2022.03～2024.07 &ensp; クライアントリード

- **プロジェクト概要**：NBA公式ライセンスを受けた3対3ストリートバスケットボール競技モバイルゲーム（ iOS / Android 対応 ）

- **使用技術**：Unity, C#, [xLua](https://github.com/Tencent/xLua), [behaviac](https://github.com/Tencent/behaviac), 状態同期, SVN

#### **担当業務**

    1. キャラクタースキル

![DCD_character_skill_example](./img/DCD_character_skill_example.gif)

| 移動 | シュート | レイアップ | ダンク | ポストプレー | ピック＆ロール | ブロック | ドライブ |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| ![DCD_character_skill_move](./img/DCD_character_skill_move.gif) | ![DCD_character_skill_shoot](./img/DCD_character_skill_shoot.gif) | ![DCD_character_skill_layup](./img/DCD_character_skill_layup.gif) | ![DCD_character_skill_dunk](./img/DCD_character_skill_dunk.gif) | ![DCD_character_skill_postup](./img/DCD_character_skill_postup.gif) | ![DCD_character_skill_screen](./img/DCD_character_skill_screen.gif) | ![DCD_character_skill_block](./img/DCD_character_skill_block.gif) | ![DCD_character_skill_break](./img/DCD_character_skill_break.gif) |

球员的每种行为都是技能，包括移动，投篮，上篮，扣篮，背打，拆当，盖帽，突破等一系列基础技能，以及多种基础技能的组合

選手のあらゆる行動はスキルであり、移動、シュート、レイアップ、ダンク、ポストプレー、ピック＆ロール、ブロック、ドライブなどの基本的なスキル、そして複数の基本スキルを組み合わせた動作も含まれます。

- **アニメーションの予備演出 动画预表现**

为了能让玩家流畅的操作球员，球员的每个技能的释放不会先征求服务端的确定，而是直接开启技能流程，每种技能的流程中，都会有1个或多个关键节点，或时间执行到关键节点时，还没收到服务器的相应，则会将将动画放慢，比如说0.1倍

アニメーションの予備演出
プレイヤーがスムーズに選手を操作できるようにするために、各スキルの発動はサーバーからの許可を待たず、即座にスキルフローを開始します。
それぞれのスキルフローには1つまたは複数の重要なノード（キータイミング）が設定されており、もしそのタイミングまでにサーバーからの応答が届いていない場合、アニメーションは一時的にスローモーションになります（例えば、0.1倍速）。

以投篮技能为例，"篮球出手"则是关键节点

例としてシュートスキルの場合、「リリースポイント」がキーとなるノード（重要なタイミング）です。

![DCD_shoot_ball_out](./img/DCD_shoot_ball_out.png)

当玩家按下投篮按键，客户端会向服务器发送请求，并马上播放投篮动画。在正常网速下，在"篮球出手"点前，客户端会收到服务器返回的确认信息。若没收到，则将动画放慢执行，以继续等待。若收到服务器下发的是“成功”确认消息，则执行技能后续流程。若收到“失败”确认消息，进行回滚。

プレイヤーがシュートボタンを押すと、クライアントはサーバーにリクエストを送信し、すぐにシュートアニメーションを再生します。通常の通信速度であれば、「ボールリリース（出手）」のタイミングまでに、クライアントはサーバーからの確認メッセージを受け取ります。もし確認メッセージが届かなかった場合、アニメーションをスロー再生して引き続き待機します。サーバーから「成功」の確認メッセージが届いた場合は、スキルの後続処理を実行します。「失敗」の確認メッセージが届いた場合は、ロールバックを行います。

    2. キャラクターの行動AIロジック

AIは2種類に分けられます。ひとつはビヘイビアツリーAI、もうひとつは強化学習AIです。

    2.1 ビヘイビアツリーAI

行为树AI是基于behaviac开发的，通过控制参数，可以很方便的调节AI的强度。我的主要工作是建立框架，并依据策划的需求提供各种API。

行为ツリーAIは[behaviac](https://github.com/Tencent/behaviac)を基盤として開発されており、パラメーターを調整することでAIの強さを簡単にコントロールできます。私の主な業務はフレームワークの構築と、プランナーの要望に応じて各種APIを提供することです。

游戏内存在一种挂机玩法，双方的球员都由AI控制，如下图所示

ゲーム内には放置プレイのようなモードがあり、双方の選手はすべてAIによって操作されます。下の図をご覧ください。

![DCD_coach_mode](./img/DCD_coach_mode.gif)

    2.2 強化学習AI

强化学习训练和部署由别的部门的人员负责，我主要提供游戏逻辑的支持。

強化学習のトレーニングとデプロイは他の部署の担当者が行っており、私は主にゲームロジックのサポートを提供しています。

    3. アニメーション編集ツール

“动画编辑工具”是基于Unity的IMGUI而开发的用于策划编辑球员技能动画的工具。球员的技能由一段或多段动画组合而成，策划通过该工具编辑技能所使用的动画，以及音效、特效、镜头、Buff、等一系列配置。由于是内部工具，所以无法提供公开截图。

「アニメーション編集ツール」は、Unity の IMGUI をベースに開発された、プランナーが選手のスキルアニメーションを編集するための社内向けツールです。選手のスキルは一つまたは複数のアニメーションによって構成されており、プランナーはこのツールを使って、スキルで使用されるアニメーションのほか、サウンドエフェクト、ビジュアルエフェクト、カメラ演出、バフなど、一連の構成要素を編集・設定することができます。なお、本ツールは社内専用のため、一般向けのスクリーンショットは公開できません。

以下为示例图。

以下、サンプル画像となります。

![DCD_skill_animation_editor](./img/DCD_skill_animation_editor.png)

アニメーションは Unity の [Playable API](https://docs.unity3d.com/ja/2023.2/Manual/Playables.html) をベースに開発されており、自由にアニメーションを分割・組み合わせることができるようになっています。

    4. その他

その他の細々とした機能

    4.1 トレーニング場

训练场用于开启单机游戏。“InGame”服务器的代码内嵌如客户端，在客户端本地开启一个小型的“InGame”服务器。

トレーニング場はシングルプレイ用のゲームを開始するために使われます。
"InGame"サーバーのコードはクライアントに組み込まれており、クライアント側でローカルの小型"InGame"サーバーが起動します。

![DCD_server_ingame](./img/DCD_server_ingame.png)

    4.2 スキルデモ

![DCD_skill_instruction](./img/DCD_skill_instruction.gif)

上图中的技能演示不是使用视频，而是开启单机游戏，用AI操作球员，使用RenderTexture显示到界面上。通过一系列优化，使得开启演示的时间不超过2S。不使用视频，可以极大减少包体，并且修改技能后，无需重新录制视频。

上の図のスキルデモは動画を使用しているわけではなく、シングルプレイのゲームを起動し、AIが選手を操作して、RenderTextureで画面に表示しています。一連の最適化により、デモの起動時間は2秒以内に抑えられています。動画を使わないことでパッケージサイズを大幅に削減でき、スキルを修正した際も動画を再録する必要がありません。

    4.3 スキルデモ・観戦

![DCD_replay](./img/DCD_replay.gif)

服务器会把一场战斗的基本信息、每个球员的指令、服务器的指令都保存在一个文件里，该文件就是录像文件。客户端播放录像时，就是解析该录像文件，开启一局本地游戏，按照时间逐条执行指令。

观战则是类似的，服务器把实时转发指令到观战者的客户端。

サーバーは、ひとつの試合の基本情報や各選手のコマンド、サーバー側の指令などをすべてひとつのファイルに保存します。このファイルがリプレイファイルとなります。クライアントがリプレイを再生する際は、そのリプレイファイルを解析し、ローカルで試合を開始して、指令を時間順に実行していきます。

観戦の場合も同様で、サーバーがリアルタイムで指令を観戦者のクライアントに転送します。

---

### [トムとジェリー：チェイスチェイス （Tom and Jerry: Chase）](https://www.tomandjerrychaseasia.com/)

![Tom and Jerry: Chase Icon](./img/TAJC_Icon.png)

> NetEase Games (中国 网易) &ensp; 互娱部 &ensp; 2019.06～2022.03 &ensp; クライアントリード

- **プロジェクト概要**：人気アニメ「トムとジェリー」を題材にした1vs4非対称型対戦アクションゲームです

- **使用技術**：Cocox2d-x, C/C++, Lua, [Box2d](https://github.com/erincatto/box2d), [Spine](https://esotericsoftware.com/), 決定論的物理を用いたフレーム同期

#### **担当業務**

    1. キャラクタースキル・環境インタラクション

<table>
  <tr>
    <td><img src="./img/TAJC_skill_jerry.gif"></td>
    <td><img src="./img/TAJC_skill_robin.gif"></td>
    <td><img src="./img/TAJC_skill_pirate.gif"></td>
    <td><img src="./img/TAJC_skill_lightning.gif"></td>
  </tr>
  <tr>
    <td><img src="./img/TAJC_item_firecracker.gif"></td>
    <td><img src="./img/TAJC_item_ice.gif"></td>
    <td><img src="./img/TAJC_item_magic_bottle.gif"></td>
    <td><img src="./img/TAJC_item_fruit.gif"></td>
  </tr>
</table>

![TAJC_ingame_logic](./img/TAJC_ingame_logic.png)

- 帧同步，所有游戏逻辑都在客户端，服务器只转发指令
- フレーム同期では、ゲームの全ロジックはクライアントで処理され、サーバーは指令の中継のみを行う。

- 所有客户端每隔N帧，根据当前游戏状态计算一个类似MD5的值，发送给服务器，以判断是否出现不同步，或作弊
- 全てのクライアントは一定のフレームごとに、現在のゲーム状態からMD5のようなハッシュ値を計算し、それをサーバーに送信します。
これにより、同期のずれや不正行為の有無を判定できます

- 所有逻辑部分的运算都是确定性的，单线程、定点数（Box2D 被修改成了跨平台一致性）
- すべてのロジック処理は決定論的に実行され、シングルスレッドかつ固定小数点演算を採用しています。また、Box2Dもクロスプラットフォームで結果が一致するように修正されています。

由于Ingame服务器只转发指令，所以负载很低，128G内存64核的服务器貌似最大能承载20万人

Ingameサーバーはコマンド（指令）を転送するだけなので、負荷は非常に低いです。そのため、128GBのメモリと64コアのサーバーの場合、最大で20万人程度を同時に処理できるようです。

    2. 新人ガイド

状態遷移を使って様々なステートを切り替える。
企画チームと各種インターフェースを取り決め、企画はJsonファイルを使ってステートマシンを設定する。

![TAJC_guide](./img/TAJC_guide.gif)

    3. 周辺システム

主にUI開発です。

    3.1 限定イベント

さまざまな期間限定イベントのテンプレートを開発し、企画担当がそのテンプレートに従ってイベントを設定する。

![TAJC_activity](./img/TAJC_activity.gif)

    3.2 ガチャシステム

抽選プロセスを表示する。

![TAJC_lottery_1](./img/TAJC_lottery_1.gif)
![TAJC_lottery_2](./img/TAJC_lottery_2.gif)
